<form class="goblin-quest-sheet flexcol" autocomplete="off">
    <!-- Single Toggle Button -->
    <button type="button" class="single-view-toggle" data-current="character-view" title="Ver Tareas">
        <i class="fas fa-tasks"></i>
    </button>

    <!-- Character View (original content) -->
    <div class="view-section character-view character-section">
    <div class="left-panel">
        <div class="clan-info-top">

                <h1 class="clan-name-input">
                    <input name="name" type="text" value="{{actor.name}}" placeholder="Nombre del Clan Goblin"/>
                </h1>
                <div class="clan-details-grid">
                    <div class="clan-details-row flexrow">
                        <div class="form-group">
                            <label>Sueño</label>
                            <input type="text" name="system.details.dream" value="{{system.details.dream}}"/>
                        </div>
                        <div class="form-group">
                            <label>Rareza</label>
                            <input type="text" name="system.details.rarity" value="{{system.details.rarity}}"/>
                        </div>
                    </div>
                    <div class="clan-details-row flexrow">
                        <div class="form-group">
                            <label>Pericia</label>
                            <input type="text" name="system.details.expertise" value="{{system.details.expertise}}"/>
                        </div>
                        <div class="form-group relic-name">
                            <label>Reliquia Familiar</label>
                            <input type="text" name="system.details.relicName" value="{{system.details.relicName}}"/>
                        </div>
                    </div>
                </div>
                <div class="clan-details-row flexrow">
                    <div class="form-group dice-pool">
                        <label># Dados</label>
                        <div class="checkbox-group" data-max="{{system.dicePool.max}}">
                            {{#each (range 0 system.dicePool.max) as |i|}}
                            <input type="checkbox" name="dicePool-{{i}}" data-idx="{{i}}" {{#if (lt i (lookup ../system.dicePool 'value'))}}checked{{/if}}>
                            {{/each}}
                        </div>
                        <div class="roll-button-container">
                            <button type="button" class="roll-button">Tirada</button>
                        </div>
                    </div>
                </div>
        </div>

        <nav class="sheet-tabs tabs goblin-tabs" data-group="goblins">
            {{#each system.goblins as |goblin key|}}
                <a class="item {{#if @first}}active{{/if}}" data-tab="{{key}}">{{goblin.name}}{{#unless goblin.name}}Goblin {{add @index 1}}{{/unless}}</a>
            {{/each}}
        </nav>

        <section class="sheet-body goblin-details-section">
            {{#each system.goblins as |goblin key|}}
                <div class="tab goblin-tab {{#if @first}}active{{/if}}" data-group="goblins" data-tab="{{key}}">
                    <div class="goblin-card flexrow">
                        <div class="goblin-image-container">
                            <img class="profile-img" src="{{goblin.img}}" data-edit="system.goblins.{{key}}.img" title="{{goblin.name}}" alt="Image of a Goblin"/>
                        </div>
                        <div class="goblin-info flexcol">
                            <h2 class="goblin-name"><input name="system.goblins.{{key}}.name" type="text" value="{{goblin.name}}" placeholder="Nombre del Goblin"/></h2>
                            <div class="form-group goblin-extra-info">
                                <label>Caracteristica</label>
                                <input type="text" name="system.goblins.{{key}}.feature" value="{{goblin.feature}}"/>
                            </div>
                            <div class="form-group goblin-extra-info">
                                <label>Causa de Muerte</label>
                                <input type="text" name="system.goblins.{{key}}.causeOfDeath" value="{{goblin.causeOfDeath}}"/>
                            </div>
                            <div class="form-group goblin-health">
                                <label>Daño</label>
                                <div class="checkbox-group health-checkboxes">
                                    <input type="checkbox" data-idx="0" name="system.goblins.{{key}}.health.hp1" {{#if goblin.health.hp1}}checked{{/if}}>
                                    <input type="checkbox" data-idx="1" name="system.goblins.{{key}}.health.hp2" {{#if goblin.health.hp2}}checked{{/if}}>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            {{/each}}
        </section>
    </div>
    </div>

    <!-- Tasks View (readonly GM Panel copy) -->
    <div class="view-section tasks-view tasks-section" hidden>
        <form class="readonly-tasks-panel tasks-section">
            <div class="right-panel">
                <div class="objective-sectionp">
                    <h2 class="objective-title"><textarea readonly style="resize: none;" placeholder="Objetivo o Misión">{{globalTasks.objective}}</textarea></h2>
                </div>
                <!-- Task 1 -->
                <div class="task-column flexcol">
                    <h3 class="task-name"><input type="text" readonly value="{{globalTasks.tasks.task1.name}}" placeholder="tarea 1"/></h3>
                    {{#with globalTasks.tasks.task1.levels.level1 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 1">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task1.levels.level2 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 2">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task1.levels.level3 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 3">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                </div>

                <!-- Task 2 -->
                <div class="task-column flexcol">
                    <h3 class="task-name"><input type="text" readonly value="{{globalTasks.tasks.task2.name}}" placeholder="tarea 2"/></h3>
                    {{#with globalTasks.tasks.task2.levels.level1 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 1">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task2.levels.level2 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 2">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task2.levels.level3 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 3">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                </div>

                <!-- Task 3 -->
                <div class="task-column flexcol">
                    <h3 class="task-name"><input type="text" readonly value="{{globalTasks.tasks.task3.name}}" placeholder="tarea 3"/></h3>
                    {{#with globalTasks.tasks.task3.levels.level1 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 1">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task3.levels.level2 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 2">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                    {{#with globalTasks.tasks.task3.levels.level3 as |level|}}
                    <div class="task-level-container">
                        <div class="level-header">
                            <input type="text" class="task-level-label" readonly value="{{level.name}}" placeholder="Nivel 3">
                        </div>
                        <div class="level-content">
                            <div class="checkbox-section">
                                <div class="checkbox-group task-checkboxes">
                                    {{#each (range 0 level.numCheckboxes) as |i|}}
                                    <input type="checkbox" disabled {{#if (lookup level.checkboxStates i)}}checked{{/if}}>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="complication-section">
                                <label class="complication-label">Complicación</label>
                                <input type="checkbox" class="complication-checkbox" disabled {{#if level.complication}}checked{{/if}}>
                            </div>
                        </div>
                    </div>
                    {{/with}}
                </div>
            </div>
        </form>
    </div>

</form>
